# Gradle packaging plugin

This plugin wil help you to build OS packages (.deb or .rpm) from Java (or Groovy, or Scala) sources.

## Quick Start
For start using this plugin just include this lines in your [Gradle](http://gradle.org) build script.

```groovy
// Pull the plugin from Maven Central
buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath "org.jamel.pkg4j:pkg4j-gradle:0.0.6"
    }
}

// Invoke the plugin
apply plugin: 'pkg4j'

version = "1.0.0"

// Provide information for build package
pkg {
    name = "my-supper-app"
    description = "This is my Supper App."
    changes = "src/pkg/changes.txt"

    dirs {
        create "/var/cache/supper-app", owner: "app-user"
        pack dir: "src/pkg/etc", prefix: "/etc", mode: "775"
        pack dir: "src/pkg/bin", prefix: "/usr/lib/supper-app/bin"
        pack dir: "build/libs",  prefix: "/usr/lib/supper-app/libs"
    }

    depends {
        on "openjdk-6-jre | default-jre"
        on "postfix (>= 2.7.0)"
    }

    // generate installation scripts
    postinst { exec "update-rc.d supper-app defaults 90 20" }
    prerm    { exec "update-rc.d -f supper-app remove" }
}
```

In changes.txt you must provide release information. Something like this:

```
release date=15:00 03.14.2013,version=1.0.0
 * first stable release
release date=14:00 03.01.2013,version=0.0.1
 * initial release
```

Then you can use buildDeb task:

```
    ./gradlew clean build buidlDeb
```

## Manually created installation scripts

If you need more complex installation scripts or preinst / postrm (which generation is not supported by the plugin) you can write them manually and specify from where to copy them:

```
pkg {
	...

	// note that installation scripts (preinst|postinst|prerm|postrm) found in this folder
	// will have priority over the scripts generated by plugin
	deb { scripts "src/pkg/debian" }
}
```

## Package with runtime dependencies

If you want build package which includes all your runtime dependencies you could use this snippet:

```
// copy all runtime dependencies to build/libs folder
task copyLibs(type: Copy, dependsOn: "build") {
    from configurations.runtime
    into "$buildDir/libs"
}

// "deb" is shortcut name of buildDeb which invokes copyLibs before run
task deb(type: org.jamel.pkg4j.gradle.tasks.BuildDebTask, dependsOn: copyLibs)
```

Then for build deb package you can run this command:

```
./gradlew clean deb
```
